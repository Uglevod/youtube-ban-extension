#!/bin/bash

# –°–∫—Ä–∏–ø—Ç –¥–ª—è —Å–æ–∑–¥–∞–Ω–∏—è –ø—Ä–∞–≤–∏–ª—å–Ω–æ–≥–æ XPI —Ñ–∞–π–ª–∞ –¥–ª—è Firefox

echo "üîß –°–æ–∑–¥–∞–Ω–∏–µ XPI —Ñ–∞–π–ª–∞ –¥–ª—è Firefox"
echo "=================================="

# –£–¥–∞–ª—è–µ–º —Å—Ç–∞—Ä—ã–π XPI –µ—Å–ª–∏ –µ—Å—Ç—å
if [ -f "YBan.xpi" ]; then
    echo "üóëÔ∏è  –£–¥–∞–ª—è–µ–º —Å—Ç–∞—Ä—ã–π XPI —Ñ–∞–π–ª..."
    rm YBan.xpi
fi

# –°–æ–∑–¥–∞–µ–º –≤—Ä–µ–º–µ–Ω–Ω—É—é –ø–∞–ø–∫—É –¥–ª—è —Å–±–æ—Ä–∫–∏
TEMP_DIR="temp_xpi"
if [ -d "$TEMP_DIR" ]; then
    rm -rf "$TEMP_DIR"
fi

echo "üìÅ –°–æ–∑–¥–∞–µ–º –≤—Ä–µ–º–µ–Ω–Ω—É—é –ø–∞–ø–∫—É..."
mkdir "$TEMP_DIR"

# –ö–æ–ø–∏—Ä—É–µ–º —Ç–æ–ª—å–∫–æ –Ω–µ–æ–±—Ö–æ–¥–∏–º—ã–µ —Ñ–∞–π–ª—ã –¥–ª—è —Ä–∞—Å—à–∏—Ä–µ–Ω–∏—è
echo "üìã –ö–æ–ø–∏—Ä—É–µ–º —Ñ–∞–π–ª—ã —Ä–∞—Å—à–∏—Ä–µ–Ω–∏—è..."

# –û—Å–Ω–æ–≤–Ω—ã–µ —Ñ–∞–π–ª—ã
cp manifest.json "$TEMP_DIR/"
cp background.js "$TEMP_DIR/"
cp content.js "$TEMP_DIR/"
cp popup.html "$TEMP_DIR/"
cp popup.js "$TEMP_DIR/"
cp popup.css "$TEMP_DIR/"
cp styles.css "$TEMP_DIR/"

# –ü–∞–ø–∫–∞ —Å –∏–∫–æ–Ω–∫–∞–º–∏
cp -r icons "$TEMP_DIR/"

# –ü—Ä–æ–≤–µ—Ä—è–µ–º —Å—Ç—Ä—É–∫—Ç—É—Ä—É
echo "üîç –ü—Ä–æ–≤–µ—Ä—è–µ–º —Å—Ç—Ä—É–∫—Ç—É—Ä—É XPI..."
ls -la "$TEMP_DIR/"

# –°–æ–∑–¥–∞–µ–º XPI –∞—Ä—Ö–∏–≤
echo "üì¶ –°–æ–∑–¥–∞–µ–º XPI –∞—Ä—Ö–∏–≤..."
cd "$TEMP_DIR"
zip -r ../YBan.xpi . -x "*.DS_Store" "*.git*" "test_*" "*.md" "*.sh"
cd ..

# –£–¥–∞–ª—è–µ–º –≤—Ä–µ–º–µ–Ω–Ω—É—é –ø–∞–ø–∫—É
echo "üßπ –û—á–∏—â–∞–µ–º –≤—Ä–µ–º–µ–Ω–Ω—ã–µ —Ñ–∞–π–ª—ã..."
rm -rf "$TEMP_DIR"

# –ü—Ä–æ–≤–µ—Ä—è–µ–º —Å–æ–∑–¥–∞–Ω–Ω—ã–π XPI
echo "‚úÖ –ü—Ä–æ–≤–µ—Ä—è–µ–º —Å–æ–∑–¥–∞–Ω–Ω—ã–π XPI..."
echo "üìä –†–∞–∑–º–µ—Ä —Ñ–∞–π–ª–∞:"
ls -lh YBan.xpi

echo "üìã –°–æ–¥–µ—Ä–∂–∏–º–æ–µ XPI:"
unzip -l YBan.xpi

echo ""
echo "üéâ XPI —Ñ–∞–π–ª —Å–æ–∑–¥–∞–Ω —É—Å–ø–µ—à–Ω–æ!"
echo "üìÅ –§–∞–π–ª: YBan.xpi"
echo ""
echo "üìã –ò–Ω—Å—Ç—Ä—É–∫—Ü–∏–∏ –ø–æ —É—Å—Ç–∞–Ω–æ–≤–∫–µ:"
echo "1. –û—Ç–∫—Ä–æ–π—Ç–µ Firefox"
echo "2. –ü–µ—Ä–µ–π–¥–∏—Ç–µ –≤ about:addons"
echo "3. –ù–∞–∂–º–∏—Ç–µ '–£—Å—Ç–∞–Ω–æ–≤–∏—Ç—å –¥–æ–ø–æ–ª–Ω–µ–Ω–∏–µ –∏–∑ —Ñ–∞–π–ª–∞'"
echo "4. –í—ã–±–µ—Ä–∏—Ç–µ —Ñ–∞–π–ª YBan.xpi"
echo "5. –ü–æ–¥—Ç–≤–µ—Ä–¥–∏—Ç–µ —É—Å—Ç–∞–Ω–æ–≤–∫—É"
echo ""
echo "‚ö†Ô∏è  –ï—Å–ª–∏ Firefox –ø–æ–∫–∞–∑—ã–≤–∞–µ—Ç '—Ñ–∞–π–ª –ø–æ–≤—Ä–µ–∂–¥–µ–Ω':"
echo "1. –í–∫–ª—é—á–∏—Ç–µ 'about:config'"
echo "2. –ù–∞–π–¥–∏—Ç–µ 'xpinstall.signatures.required'"
echo "3. –£—Å—Ç–∞–Ω–æ–≤–∏—Ç–µ –∑–Ω–∞—á–µ–Ω–∏–µ 'false'"
echo "4. –ü–µ—Ä–µ–∑–∞–ø—É—Å—Ç–∏—Ç–µ Firefox"
echo "5. –ü–æ–ø—Ä–æ–±—É–π—Ç–µ —É—Å—Ç–∞–Ω–æ–≤–∏—Ç—å —Å–Ω–æ–≤–∞"
